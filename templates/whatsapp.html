{% extends 'base.html' %}

{% block content %}

<div class="keyphrase-extraction-container">
    <!-- Title and Introduction Section -->
    <h1 class="keyphrase-extraction-title">WhatsApp</h1>

    <div class="introduction">
        <h2>Introduction</h2>
        <p>Analyzing WhatsApp conversations can reveal important communication patterns and sentiments. A specialized
            tool simplifies this process, starting with exporting the chat from WhatsApp by clicking on the three dots
            in the conversation, selecting "More," and then "Export Chat." Once downloaded, the chat file can be
            uploaded to the tool for analysis.</p> <!-- Placeholder for introduction text -->
    </div>

    <!-- Functionality Section -->
    <div class="functionality">
        <h2>Functionality</h2>
        <p>The tool analyzes both individual and group chats, generating graphs that show conversation frequency by
            hour, day, week, and month. It also displays participant activity, most mentioned words, and sentiment.
            Users upload the chat file, select the language, and click "Analyze Chat." The tool provides an overview of
            chat dynamics and a sentiment analysis graph that shows the average polarity, indicating the overall
            emotional tone of the conversation.</p> <!-- Placeholder for functionality description -->
    </div>
</div>

<div class="keyphrase-extraction-container">
    <!-- Upload Form Section -->
    <div class="upload-form">
        <form class="keyphrase-extraction-form" action="/whatsapp" method="post" enctype="multipart/form-data">
            <label for="file">Upload WhatsApp chat (only .txt files allowed):</label><br>
            <input type="file" id="file" name="file" accept=".txt" required><br><br>

            <!-- Container for the text "Select Language" -->
            <div class="language-container">
                <label for="language">Select Language:</label>
            </div>

            <!-- Language dropdown menu -->
            <div class="select-language-container">
                <select id="language" name="language">
                    <option value="english">English</option>
                    <!-- Add more options as needed -->
                </select>
            </div>
            <br><br>
            <button type="submit" class="show-results">Analyze Chat</button>
        </form>
    </div>
</div>

<!-- Display general plots if available -->
{% if general_images %}
<div class="keyphrase-extraction-container">
    <h2>General Plots</h2>
    <div class="plot-container">
        {% for image in general_images %}
        <img src="{{ url_for('static', filename='temp_images/' + image) }}">
        {% endfor %}
    </div>
</div>
{% endif %}

<!-- Display plots for each issuer if available -->
{% if per_issuer_images %}
{% for issuer, images in per_issuer_images.items() %}
<div class="keyphrase-extraction-container">
    <h2>Plots for {{ issuer }}</h2>
    <div class="plot-container">
        {% for image in images %}
        <img src="{{ url_for('static', filename='temp_images/' + image) }}">
        {% endfor %}
    </div>
</div>
{% endfor %}
{% endif %}

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // List of 50 popular languages (can be obtained from an external source)
        var languages = [
            'English', 'Spanish', 'French', 'German', 'Chinese', 'Japanese', 'Italian', 'Portuguese', 'Russian', 'Arabic',
            'Hindi', 'Bengali', 'Urdu', 'Turkish', 'Indonesian', 'Dutch', 'Polish', 'Thai', 'Vietnamese', 'Korean',
            'Persian', 'Malay', 'Swedish', 'Greek', 'Romanian', 'Hungarian', 'Czech', 'Danish', 'Finnish', 'Norwegian',
            'Hebrew', 'Swahili', 'Slovak', 'Bulgarian', 'Croatian', 'Serbian', 'Ukrainian', 'Lithuanian', 'Latvian',
            'Estonian', 'Slovenian', 'Icelandic', 'Maltese', 'Albanian', 'Macedonian', 'Georgian', 'Belarusian', 'Basque'
        ];

        // Sort languages alphabetically (ascending order)
        languages.sort();

        var selectLanguage = document.getElementById('language');

        // Add options to the dropdown menu
        languages.forEach(function (language) {
            var option = document.createElement('option');
            option.text = language;
            option.value = language.toLowerCase(); // Lowercase value for form submission
            selectLanguage.add(option);
        });
    });
</script>
{% endblock %}